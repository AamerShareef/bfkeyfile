#!/bin/bash
#
# GPLv3
# Thomas Dwyer
# tomd.tel
#

iteration=1000
keyfile="enc_keyfile.bin"

echo "$keyfile encrypted keyfile will be created"
echo ''
read -rsp "Enter password: " password
echo ''
read -rsp "Enter password Agin: " verify
if [ $password == $verify ]; then
	passwordHash=$password
	for (( i=1; i<=$iteration; i++ )); do
		passwordHash=`echo $passwordHash | openssl dgst -whirlpool -hex | cut -d ' ' -f 2`
	done
	password=$password$passwordHash`echo $passwordHash | openssl dgst -whirlpool -hex | cut -d ' ' -f 2`

	dd if=/dev/urandom bs=1k count=512 | openssl bf-cbc -pass pass:"${password}" -out "${keyfile}"
else
	echo "Passwords did not match"
fi