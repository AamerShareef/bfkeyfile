# vim: set ft=sh:
#
# GPLv3
# Thomas Dwyer
# tdwyer.tel
#

install ()
{
    MODULES=""
    FILES=""
    SCRIPT="bfkf"
    add_binary "/usr/bin/openssl"
}

help ()
{
cat<<HELPEOF
  This hook allows for an openssl (bf-cbc) encrypted keyfile for LUKS.
  It relies on standard 'encrypt' hook providing decrypted '/crypto_keyfile.bin' for it.

  You must use gen-cryptkey create the encrypted enc_keyfile.bin
  The password is hashed with Whirlpool 1000 times and 1001 times.
  Then your password + 1000 Hash + 1001 Hash is used to encrypt the keyfile.

  Kernel Parameters:
  Two options are supported:
  1) Using a file on the device:
     bfkf=<device>:<fs-type>:<path>
  2) Reading raw data from the block device:
     bfkf=<device>:<offset>:<size>
HELPEOF
}